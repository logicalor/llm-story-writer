# Multistep Story Enrichment Analysis

This directory contains prompts for a 5-step approach to analyzing story enrichment opportunities. The multistep approach ensures that the AI model has a comprehensive understanding of all story components before making enrichment recommendations.

## Prompt Sequence

### 1. `understand_story_elements.md`
- **Purpose**: Ensures the AI understands the core story elements and plot points
- **Input**: `{{story_elements}}` - The main story elements extracted from the prompt
- **Output**: Confirmation that the story elements have been understood
- **Focus**: Main plot, themes, tone, and key details

### 2. `understand_base_context.md`
- **Purpose**: Ensures the AI understands the foundational world-building and context
- **Input**: `{{base_context}}` - The base context extracted from the prompt
- **Output**: Confirmation that the base context has been understood
- **Focus**: World-building, premise, setting, constraints

### 3. `understand_character_summaries.md`
- **Purpose**: Ensures the AI understands the character information and relationships
- **Input**: `{{character_summaries}}` - Character summaries generated by the character manager
- **Output**: Confirmation that the character information has been understood
- **Focus**: Character roles, relationships, motivations, arcs

### 4. `understand_setting_summaries.md`
- **Purpose**: Ensures the AI understands the setting and environmental details
- **Input**: `{{setting_summaries}}` - Setting summaries generated by the setting manager
- **Output**: Confirmation that the setting information has been understood
- **Focus**: Locations, time period, atmosphere, cultural elements

### 5. `analyze_enrichment.md`
- **Purpose**: Analyzes enrichment opportunities based on comprehensive understanding
- **Input**: `{{desired_chapters}}` - Target number of chapters for the novel
- **Output**: Detailed enrichment analysis and recommendations
- **Focus**: Plot, character, setting, theme, and pacing enrichment opportunities

## Benefits of Multistep Approach

1. **Comprehensive Understanding**: Each step ensures the AI has processed specific information
2. **Contextual Awareness**: Later steps build on understanding from earlier steps
3. **Focused Analysis**: Each prompt has a single, clear purpose
4. **Better Quality**: The final analysis benefits from thorough comprehension of all components
5. **Debugging**: Each step can be monitored and debugged independently

## Usage in Code

The multistep approach is implemented in the `_analyze_story_enrichment` method of the `OutlineGenerator` class. Each step:

1. Loads the appropriate prompt with variables
2. Adds it to the conversation history
3. Executes the conversation with savepoint management
4. Adds the AI's response to the conversation history
5. Proceeds to the next step

## Savepoint Management

Each step creates its own savepoint:
- `enrichment_step1_story_elements`
- `enrichment_step2_base_context`
- `enrichment_step3_character_summaries`
- `enrichment_step4_setting_summaries`
- `enrichment_suggestions` (final result)

This allows for debugging and potential regeneration of specific steps if needed.
